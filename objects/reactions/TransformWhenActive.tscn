[gd_scene load_steps=2 format=2]

[sub_resource type="GDScript" id=2]
resource_name = "TransformWhenActive"
script/source = "extends Node

const Activatable = preload(\"res://scripts/widgets/interactable/Activatable.gd\")

var target: Spatial
var react_to: Activatable
var anim_progress = 0.0
var base: Transform
export var anim_time: float = 0.2
export(float, -5, 5) var snappiness: float = 0.0
export var translation: Vector3 = Vector3.ZERO
export var rotation: float = 0.0
export var rotation_axis: Vector3 = Vector3.RIGHT

func _ready():
	target = Util.get_parent_spatial(self.get_parent())
	base = target.transform
	react_to = Util.get_parent_activatable(self)

func _process(delta):
	delta = delta / anim_time
	var position = 0.0
	var exponent = pow(2, snappiness)
	if react_to.activated:
		anim_progress = min(anim_progress + delta, 1.0)
		position = 1.0 - pow(1.0 - anim_progress, exponent)
	else:
		anim_progress = max(anim_progress - delta, 0.0)
		position = pow(anim_progress, exponent)
	var offset = Transform.IDENTITY \\
		.translated(translation).rotated(rotation_axis, rotation)
	target.transform = base.interpolate_with(base * offset, position)
"

[node name="TransformWhenActive" type="Node"]
script = SubResource( 2 )
